{"code":"exports.ids=[0],exports.modules={0:function(e,t){e.exports=require(\"util\")},112:function(e,t,i){\"use strict\";var l=i(113);e.exports.pool=l.createPool({host:\"localhost\",user:\"root\",password:\"\",database:\"caffee\",multipleStatements:!0})},17:function(e,t){e.exports=require(\"events\")},179:function(e,t,i){\"use strict\";e.exports={query_select:\"SELECT bill.IdBill,bill.id, staff.name, tables.TableName, customers.CustomerName,DATE_FORMAT(bill.create_at , '%d-%m-%y %h:%m:%s') as create_at,bill.idStatus,bill.Totalprice, bill.Note, GROUP_CONCAT(billdetail.IdDetail SEPARATOR '@#$') as idbilldetail  ,GROUP_CONCAT(billdetail.IdMenu SEPARATOR '@#$') as idmenu, GROUP_CONCAT(billdetail.Quantity SEPARATOR '@#$') as quantity, GROUP_CONCAT(billdetail.Price SEPARATOR '@#$') as billdetail_price , GROUP_CONCAT(menus.NameMenu SEPARATOR '@#$') as namemenu,GROUP_CONCAT(menus.Unit SEPARATOR '@#$') as unit,GROUP_CONCAT(menus.Price SEPARATOR '@#$') as menu_price FROM  billdetail,users,tables,staff, menus, bill LEFT JOIN customers ON bill.IdCustomer = customers.IdCustomer   WHERE bill.IdBill = billdetail.IdBill and bill.IdUser=users.UserId and bill.IdTable = tables.IdTable  AND users.id_staff = staff.id AND billdetail.IdMenu = menus.IdMenu GROUP BY billdetail.IdBill\",query_searchfor_Idbill:function(e){return\"SELECT bill.IdBill, staff.name, tables.TableName, customers.CustomerName,DATE_FORMAT(bill.create_at , '%d-%m-%y %h:%m:%s') as create_at,bill.idStatus,bill.Totalprice, bill.Note, GROUP_CONCAT(billdetail.IdDetail SEPARATOR '@#$') as idbilldetail  ,GROUP_CONCAT(billdetail.IdMenu SEPARATOR '@#$') as idmenu, GROUP_CONCAT(billdetail.Quantity SEPARATOR '@#$') as quantity, GROUP_CONCAT(billdetail.Price SEPARATOR '@#$') as billdetail_price , GROUP_CONCAT(menus.NameMenu SEPARATOR '@#$') as namemenu,GROUP_CONCAT(menus.Unit SEPARATOR '@#$') as unit,GROUP_CONCAT(menus.Price SEPARATOR '@#$') as menu_price FROM bill, billdetail,users,tables,customers,staff, menus  WHERE bill.IdBill = billdetail.IdBill and bill.IdUser=users.UserId and bill.IdTable = tables.IdTable and bill.IdCustomer = customers.IdCustomer AND users.id_staff = staff.id AND billdetail.IdMenu = menus.IdMenu AND bill.IdBill LIKE '%\"+e+\"%'  GROUP BY billdetail.IdBill\"},query_searchfor_datetime:function(e,t){return\"SELECT bill.IdBill, staff.name, tables.TableName, customers.CustomerName,DATE_FORMAT(bill.create_at , '%d-%m-%y %h:%m:%s') as create_at,bill.idStatus,bill.Totalprice, bill.Note, GROUP_CONCAT(billdetail.IdDetail SEPARATOR '@#$') as idbilldetail  ,GROUP_CONCAT(billdetail.IdMenu SEPARATOR '@#$') as idmenu, GROUP_CONCAT(billdetail.Quantity SEPARATOR '@#$') as quantity, GROUP_CONCAT(billdetail.Price SEPARATOR '@#$') as billdetail_price , GROUP_CONCAT(menus.NameMenu SEPARATOR '@#$') as namemenu,GROUP_CONCAT(menus.Unit SEPARATOR '@#$') as unit,GROUP_CONCAT(menus.Price SEPARATOR '@#$') as menu_price FROM bill, billdetail,users,tables,customers,staff, menus  WHERE bill.IdBill = billdetail.IdBill and bill.IdUser=users.UserId and bill.IdTable = tables.IdTable and bill.IdCustomer = customers.IdCustomer AND users.id_staff = staff.id AND billdetail.IdMenu = menus.IdMenu AND bill.create_at BETWEEN '\"+e+\" 00:00:01' AND '\"+t+\" 23:59:59'  GROUP BY billdetail.IdBill\"},query_exportExcel:\"SELECT bill.IdBill, staff.name, tables.TableName, customers.CustomerName,DATE_FORMAT(bill.create_at , '%d-%m-%y %h:%m:%s') as create_at,bill.idStatus,bill.Totalprice, bill.Note, billdetail.IdDetail ,billdetail.IdMenu ,billdetail.Quantity, billdetail.Price ,menus.NameMenu ,menus.Unit ,menus.Price FROM bill, billdetail,users,tables,customers,staff, menus  WHERE bill.IdBill = billdetail.IdBill and bill.IdUser=users.UserId and bill.IdTable = tables.IdTable and bill.IdCustomer = customers.IdCustomer AND users.id_staff = staff.id AND billdetail.IdMenu = menus.IdMenu \"}},180:function(e,t,i){\"use strict\";(function(t){var l=i(91),a=i(8),n=l(),s=a.join(t,\"./../views\");a.join(t,\"./../assets\");n.set(\"view engine\",\"ejs\"),n.use(l.static(t+\"./../assets\")),n.set(\"views\",s),n.listen(4e3);var r=i(112),o=i(292),u=r.pool,d=i(322),c=i(324),E=i(325),b=i(326),m=i(69),f=i(343),p=i(345),T=i(442),I=i(179),R=i(443);n.use(\"/pos\",R),n.get(\"*\",(function(e,t){t.render(\"home\")})),n.use(o.json(),f.check_authenTication),n.post(\"/query/selectalldata\",(function(e,t,i){var l=e.decodeToken;switch((e=e.body).type+\"|\"+l.name){case\"TABLE|admin\":d.select_all_data(e,u,t);break;case\"ROOM|admin\":c.select_all_data(u,t);break;case\"SUPPLIER|admin\":E.select_all_data(e,u,t);break;case\"CUSTOMER|admin\":b.select_all_data(e,u,t);break;default:t.send({err:\"err\"})}})),n.post(\"/query/insertdata\",(function(e,t,i){var l=e.decodeToken;switch((e=e.body).type+\"|\"+l.name){case\"TABLE|admin\":d.insert(e,u,t);break;case\"ROOM|admin\":c.insert(e,u,t);break;case\"SUPPLIER|admin\":E.insert(e,u,t);break;case\"CUSTOMER|admin\":b.insert(e,u,t);break;default:t.send({err:\"err\"})}})),n.post(\"/get\",(function(e,t,i){t.send(e.body.user)})),n.post(\"/query/updatedata\",(function(e,t,i){var l=e.decodeToken;switch((e=e.body).type+\"|\"+l.name){case\"TABLE|admin\":d.update(e,u,t);break;case\"ROOM|admin\":c.update(e,u,t);break;case\"SUPPLIER|admin\":E.update(e,u,t);break;case\"CUSTOMER|admin\":b.update(e,u,t);break;default:t.send({err:\"err\"})}})),n.post(\"/query/deletedata\",(function(e,t,i){var l=e.decodeToken;switch((e=e.body).type+\"|\"+l.name){case\"TABLE|admin\":d.delete(e,u,t);break;case\"ROOM|admin\":c.delete(e,u,t);break;case\"SUPPLIER|admin\":E.delete(e,u,t);break;case\"CUSTOMER|admin\":b.delete(e,u,t);break;default:t.send({err:\"err\"})}})),n.post(\"/query/exportdata\",(function(e,t,i){if(e.decodeToken.name=\"admin\"){e=e.body;p.export_data(e.board,t,u)}})),n.post(\"/query/searchdata\",(function(e,t,i){if(e.decodeToken.name=\"admin\"){e=e.body;c.search(e,u,t)}})),n.post(\"/checkpass\",(function(e,t,i){e=e.body;u.query(\"SELECT * FROM users WHERE UserName ='\"+e.username+\"' and Pass = '\"+e.password+\"'\",(function(e,i){if(console.log(i),i.length>0){if(void 0!==i[0].UserId){var l={name:i[0].UserName,id_staff:i[0].id_staff},a=m.sign(l,\"shhhhh\",{expiresIn:\"30000000\"});t.send({token:a,user:i})}}else t.send({err:\"not availd token\"})}))})),n.post(\"/getstt\",(function(e,t){d.getSTT(e,u,t)})),n.post(\"/query/getstatistical\",(function(e,t){var i=\"SELECT(SELECT SUM(Totalprice) FROM   bill WHERE create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS total_revenue,(SELECT COUNT(*)FROM   bill WHERE create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS count_bill,(SELECT COUNT(*)FROM   bill, customers WHERE bill.IdCustomer = customers.IdCustomer and customers.Debit > 0 AND  create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS total_debit_bill,(SELECT SUM(customers.Debit)FROM   bill, customers WHERE bill.IdCustomer = customers.IdCustomer and customers.Debit > 0  AND  create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS sum_debit_bill,(SELECT COUNT(*)FROM   bill WHERE idStatus = 0 and create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS count_unpaid_bill,( SELECT SUM(Totalprice)FROM   bill WHERE idStatus = 0 AND create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS total_unpaid_bill\";u.query(i,(function(e,i){console.log(i),t.send(i)}))})),n.post(\"/chart\",(function(e,t){var i=[],l=e.body,a=l[0].split(\"/\").reverse().join(\"-\")+\" 00:00:01\",n=l[6].split(\"/\").reverse().join(\"-\")+\" 23:59:59\";u.query(\"SELECT SUM(Totalprice) as total,DATE_FORMAT(create_at, '%d/%m/%Y') as datetime FROM bill WHERE create_at BETWEEN '\"+a+\"' AND '\"+n+\"' GROUP BY create_at \",(function(e,a){l.forEach((function(e,t){return a.length>0&&a.forEach((function(l,a){return e==function(e){if(void 0!==e.datetime){var t=e.datetime.split(\"\");0==t[0]&&(t[0]=\"\"),0==t[3]&&(t[3]=\"\");var i=t.toString().replace(/,/gi,\"\");return console.log(i),i}return\"00/00/0000\"}(l)?(console.log(\"true\"),i[t]=l.total,i):(i[t]=0,i)})),i})),t.send(i)})),console.log(n)})),n.post(\"/query/selectallmenu\",(function(e,t){u.query(\"SELECT * FROM menus\",(function(e,i){t.send({menu:i})}))})),n.post(\"/query/selectOrder\",(function(e,t){console.log(\"da vao selectorder\"),T.query_select(t,u)})),n.post(\"/query/searchforbill\",(function(e,t){console.log(e.body),T.query_searchfor_Idbill(e.body.data,t,u)})),n.post(\"/query/searchfordatetime\",(function(e,t){var i=e.body.from,l=e.body.to;T.query_searchfor_datetime(i,l,t,u)})),n.post(\"/query/exportfrombill\",(function(e,t){console.log(I.query_exportExcel),T.query_exportData(I.query_exportExcel,t,u)})),e.exports=n}).call(this,\"/\")},190:function(e,t){e.exports=require(\"tty\")},224:function(e,t){function i(e){var t=new Error(\"Cannot find module '\"+e+\"'\");throw t.code=\"MODULE_NOT_FOUND\",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=224},242:function(e,t){e.exports=require(\"tls\")},26:function(e,t){e.exports=require(\"crypto\")},275:function(e,t){e.exports=require(\"timers\")},322:function(e,t,i){\"use strict\";var l;function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var n=i(68),s=i(49);function r(e,t,i,l){var a=\"SELECT * FROM tables WHERE IdArea LIKE '%\"+e.room+\"%' and IdTable LIKE '%\"+e.table+\"%' and idStatus LIKE '%\"+e.status+\"%'\",r=\"SELECT COUNT(*) as count FROM tables WHERE IdArea LIKE '%\"+e.room+\"%' and IdTable LIKE '%\"+e.table+\"%' and idStatus LIKE '%\"+e.status+\"%'\",o=n.pagination(e.index);s.query_inSert(o.numberOfpageForpagination,o.pageForgGetData,t,a,r,i,l)}e.exports=(a(l={insert:function(e,t,i){r(e,\"INSERT INTO tables (IdTable, TableName, idStatus,IdArea,idBill) VALUES ('\"+e.idtable+\"','\"+e.name+\"',1,'\"+e.idarea+\"','HD001')\",t,i)},select_all_data:function(e,t,i){r(e,null,t,i)}},\"select_all_data\",(function(e,t,i){r(e,null,t,i)})),a(l,\"update\",(function(e,t,i){r(e,\"UPDATE tables SET IdArea = '\"+e.idarea+\"' , IdTable  = \"+e.idtable+\" , TableName =  '\"+e.name+\"' WHERE IdTable =\"+e.idtable+\" \",t,i)})),a(l,\"delete\",(function(e,t,i){r(e,\"DELETE FROM tables WHERE IdTable = \"+e.idtable,t,i)})),a(l,\"getSTT\",(function(e,t,i){t.query(\"SELECT * FROM stttable\",(function(e,t){e?i.send([{}]):i.json(t)}))})),l)},323:function(e,t,i){\"use strict\";e.exports.Type=\"ERROR_FOR_QUERY_SQLSERVER\"},324:function(e,t,i){\"use strict\";var l=i(49);function a(e,t,i){l.query_Room(e,\"SELECT * FROM areas\",t,i)}e.exports.insert=function(e,t,i){a(\"INSERT INTO areas (IdArea, BranchName) VALUES ('\"+e.id+\"','\"+e.value+\"')\",t,i)},e.exports.select_all_data=function(e,t){a(null,e,t)},e.exports.update=function(e,t,i){a(\"UPDATE areas SET IdArea ='\"+e.idarea+\"', BranchName = '\"+e.name+\"' WHERE id = \"+e.id+\"  \",t,i)},e.exports.delete=function(e,t,i){a(\"DELETE FROM areas WHERE id =\"+e.id,t,i)},e.exports.search=function(e,t,i){var l=\"SELECT * FROM areas WHERE IdArea LIKE '%\"+e.name+\"%' OR BranchName LIKE '%\"+e.name+\"%'\";t.query(l,(function(e,t){e?i.send([{}]):i.json(t)}))}},325:function(e,t,i){\"use strict\";var l=i(68),a=i(49);function n(e,t,i,n){var s=\"SELECT * FROM suppliers WHERE Namesupplier LIKE '%\"+e.id+\"%' and Debit >= \"+e.debit,r=\"SELECT COUNT(*) as count FROM suppliers WHERE Namesupplier LIKE '%\"+e.id+\"%' and Debit >= \"+e.debit,o=l.pagination(e.index);a.query_inSert(o.numberOfpageForpagination,o.pageForgGetData,t,s,r,i,n)}e.exports.insert=function(e,t,i){n(e,\"INSERT INTO suppliers (Idsupplier, Namesupplier, Email,Phone,Address, Note, Debit, Avatar) VALUES ('\"+e.idsupplier+\"','\"+e.namesupplier+\"','\"+e.emailsupplier+\"','\"+e.phonesupplier+\"','\"+e.addresssupplier+\"','\"+e.notesupplier+\"','\"+e.debitsupplier+\"','\"+e.avatarsupplier+\"')\",t,i)},e.exports.select_all_data=function(e,t,i){n(e,null,t,i)},e.exports.update=function(e,t,i){n(e,\"UPDATE suppliers SET Idsupplier = '\"+e.idsupplier+\"' , Namesupplier  = '\"+e.namesupplier+\"' , Email =  '\"+e.emailsupplier+\"', Phone =  '\"+e.phonesupplier+\"', Address =  '\"+e.addresssupplier+\"', Note =  '\"+e.notesupplier+\"', Debit =  '\"+e.debitsupplier+\"', Avatar =  '\"+e.avatarsupplier+\"' WHERE id =\"+e.indexsupplier+\" \",t,i)},e.exports.delete=function(e,t,i){n(e,\"DELETE FROM suppliers WHERE id = \"+e.indexsupplier,t,i)},e.exports.getSTT=function(e,t,i){t.query(\"SELECT * FROM stttable\",(function(e,t){e?i.send([{}]):i.json(t)}))}},326:function(e,t,i){\"use strict\";var l=i(68),a=i(49);function n(e,t,i,n){var s=\"SELECT * FROM customers WHERE CustomerName LIKE '%\"+e.id+\"%' and Debit >= \"+e.debit,r=\"SELECT COUNT(*) as count FROM customers WHERE CustomerName LIKE '%\"+e.id+\"%' and Debit >= \"+e.debit,o=l.pagination(e.index);a.query_inSert(o.numberOfpageForpagination,o.pageForgGetData,t,s,r,i,n)}e.exports.insert=function(e,t,i){n(e,\"INSERT INTO customers (IdCustomer, CustomerName, PhoneNumber,Email,Address, Note,Birthday, Gender, Debit, Avatar) VALUES ('\"+e.idcustomer+\"','\"+e.namecustomer+\"','\"+e.phonecustomer+\"','\"+e.emailcustomer+\"','\"+e.addresscustomer+\"','\"+e.notecustomer+\"','\"+e.birthdaycustomer+\"',null,'\"+e.debitcustomer+\"','\"+e.avatarcustomer+\"')\",t,i)},e.exports.select_all_data=function(e,t,i){n(e,null,t,i)},e.exports.update=function(e,t,i){n(e,\"UPDATE customers SET IdCustomer  = '\"+e.idcustomer+\"' , CustomerName  = '\"+e.namecustomer+\"' , Email =  '\"+e.emailcustomer+\"', PhoneNumber =  '\"+e.phonecustomer+\"', Address =  '\"+e.addresscustomer+\"', Note =  '\"+e.notecustomer+\"', Debit =  '\"+e.debitcustomer+\"', Avatar =  '\"+e.avatarcustomer+\"', Birthday =  '\"+e.birthdaycustomer+\"' WHERE id =\"+e.indexcustomer+\" \",t,i)},e.exports.delete=function(e,t,i){n(e,\"DELETE FROM customers WHERE id = \"+e.indexcustomer,t,i)},e.exports.getSTT=function(e,t,i){t.query(\"SELECT * FROM stttable\",(function(e,t){e?i.send([{}]):i.json(t)}))}},33:function(e,t){e.exports=require(\"http\")},343:function(e,t,i){\"use strict\";var l=i(344);e.exports={check_authenTication:function(e,t,i){if(console.log(e.body),\"/checkpass\"!=e.originalUrl){var a=e.headers.cookie;l.checkCookie(a,e,i,t)}else i()}}},344:function(e,t,i){\"use strict\";var l=i(69);e.exports={checkCookie:function(e,t,i,a){try{l.verify(e,\"shhhhh\",(function(e,l){if(e)return console.log(e),void a.send({token:!1});console.log(\"success\"),t.decodeToken=l,t.success=\"success\",i()}))}catch(e){return console.log(e),void a.send({err:e})}}}},345:function(e,t,i){\"use strict\";var l=i(141);function a(e,t){var i=new l.Workbook,a=i.addWorksheet(\"Sheet 1\"),n=Object.keys(e[0]);e.forEach((function(e,t){t+=1;n.forEach((function(i,l){l+=1;a.cell(t,l).string(e[i].toString())}))})),i.write(\"Excel.xlsx\",t)}t.export_data=function(e,t,i){console.log(\"export\");var l=\"SELECT * FROM \"+e;i.query(l,(function(e,i){e&&a([{}],t),a(i,t)}))}},442:function(e,t,i){\"use strict\";var l=i(179),a=i(141);function n(e,t){var i=new a.Workbook,l=i.addWorksheet(\"Sheet 1\"),n=Object.keys(e[0]);e.forEach((function(e,t){t+=1;n.forEach((function(i,a){a+=1;l.cell(t,a).string(e[i].toString())}))})),i.write(\"Excel.xlsx\",t)}function s(e,t,i){if(console.log(i),!t)if(0!=i.length)for(var l=0;l<=i.length;l++){if(l==i.length)return console.log(i),void e.send(i);for(var a=[{}],n=i[l].idbilldetail.split(\"@#$\"),s=0;s<n.length;s++)a[s]={namemenu:i[l].namemenu.split(\"@#$\")[s],idbilldetail:i[l].idbilldetail.split(\"@#$\")[s],idmenu:i[l].idmenu.split(\"@#$\")[s],quantity:i[l].quantity.split(\"@#$\")[s],billdetail_price:i[l].billdetail_price.split(\"@#$\")[s],unit:i[l].unit.split(\"@#$\")[s],menu_price:i[l].menu_price.split(\"@#$\")[s]};i[l].menu_detail=JSON.stringify([].concat(a))}else e.send(i)}e.exports={query_select:function(e,t){t.query(l.query_select,(function(t,i){s(e,t,i)}))},query_searchfor_Idbill:function(e,t,i){console.log(l.query_searchfor_Idbill(e)),i.query(l.query_searchfor_Idbill(e),(function(e,i){s(t,e,i)}))},query_searchfor_datetime:function(e,t,i,a){console.log(l.query_searchfor_datetime(e,t)),a.query(l.query_searchfor_datetime(e,t),(function(e,t){s(i,e,t)}))},query_exportData:function(e,t,i){i.query(e,(function(e,i){e&&n([{}],t),n(i,t)}))}}},443:function(e,t,i){\"use strict\";var l=i(91)(),a=i(112).pool,n=i(69),s=i(444);function r(){var e=new Date,t=new Date;return\"HD-\"+(e.getDate()<10?\"0\":\"\")+e.getDate()+\"/\"+(Number(e.getMonth())+1<10?\"0\":\"\")+(Number(e.getMonth())+1)+\"/\"+e.getFullYear()+\" \"+(t.getHours()<10?\"0\":\"\")+e.getHours()+\":\"+(e.getMinutes()<10?\"0\":\"\")+e.getMinutes()+\":\"+(e.getSeconds()<10?\"0\":\"\")+e.getSeconds()}l.post(\"/getarea\",(function(e,t,i){a.query(\"SELECT * FROM areas\",(function(e,i){a.query(\"SELECT tables.IdTable, TableName,tables.idStatus,IdArea, bill.IdBill FROM tables LEFT JOIN bill ON tables.IdTable = bill.IdTable AND bill.idStatus = 0 WHERE tables.IdArea = '\"+i[0].IdArea+\"'\",(function(e,l){t.send({area:i,table:l})}))}))})),l.post(\"/gettableforselect\",(function(e,t,i){a.query(\"SELECT tables.IdTable, TableName,tables.idStatus,IdArea, bill.IdBill FROM tables LEFT JOIN bill ON tables.IdTable = bill.IdTable AND bill.idStatus = 0 WHERE tables.IdArea = '\"+e.body.data+\"'\",(function(e,i){t.send({table:i})}))})),l.post(\"/getcate\",(function(e,t,i){a.query(\"SELECT * FROM categories\",(function(e,i){a.query(\"SELECT * FROM menus WHERE Idcate = '\"+i[0].Idcate+\"' \",(function(e,l){t.send({cate:i,menu:l})}))}))})),l.post(\"/getmenuforselect\",(function(e,t,i){a.query(\"SELECT * FROM menus WHERE Idcate = \"+e.body.data+\" \",(function(e,i){t.send({menu:i})}))})),l.post(\"/searchmenu\",(function(e,t,i){\"\"!=e.body.data?(console.log(\"SELECT * FROM menus WHERE IdMenu LIKE %\"+e.body.data+\"% or NameMenu LIKE '%\"+e.body.data+\"%'\"),a.query(\"SELECT * FROM menus WHERE IdMenu LIKE '%\"+e.body.data+\"%' or NameMenu LIKE '%\"+e.body.data+\"%' \",(function(e,i){t.send({menu:i})}))):t.send({menu:[{non_Query:\"non_query\"}]})})),l.post(\"/getcustomer\",(function(e,t,i){\"\"!=e.body.data?a.query(\"SELECT * FROM customers  WHERE CustomerName LIKE '%\"+e.body.data+\"%' OR PhoneNumber LIKE '%\"+e.body.data+\"%' \",(function(e,i){t.send({customers:i})})):t.send({customers:[]})})),l.post(\"/getlistbilldetail\",(function(e,t,i){a.query(\"SELECT bill.IdBill FROM tables , bill WHERE tables.IdTable = bill.IdTable AND bill.idStatus = 0 AND tables.IdTable = \"+e.body.IdTable,(function(i,l){console.log(l),l.length>0?a.query(\"SELECT * FROM bill  WHERE IdBill  = '\"+l[0].IdBill+\"' \",(function(e,i){a.query(\"SELECT * FROM customers  WHERE IdCustomer = '\"+i[0].IdCustomer+\"'\",(function(e,n){a.query(\"SELECT * FROM tables  WHERE IdTable  = \"+i[0].IdTable,(function(e,s){a.query(\"SELECT billdetail.IdBill, billdetail.IdMenu, billdetail.Quantity, billdetail.Price as TotalPrice, menus.NameMenu, menus.Price FROM menus , billdetail WHERE IdBill = '\"+i[0].IdBill+\"' AND billdetail.IdMenu = menus.IdMenu\",(function(e,r){console.log(\"SELECT billdetail.IdBill, billdetail.IdMenu, billdetail.Quantity, billdetail.Price as TotalPrice, menus.NameMenu, menus.Price FROM menus , billdetail WHERE IdBill = '\"+i[0].IdBill+\"' AND billdetail.IdMenu = menus.IdMenu\"),a.query(\"SELECT TotalPrice FROM bill  WHERE IdBill  = '\"+i[0].IdBill+\"'\",(function(e,i){t.send({customer:n,table:s,menu:r,totalprice:i,idbill_default:l[0].IdBill})}))}))}))}))})):a.query(\"SELECT * FROM tables WHERE IdTable = '\"+e.body.IdTable+\"'\",(function(e,i){t.send({customer:[{}],table:i,menu:[],totalprice:[{TotalPrice:0}],idbill_default:null})}))}))})),console.log(r()),l.post(\"/insertpos\",(function(e,t,i){var l=e.body,n=r();if(console.log(s.parseNullToString(l.customer.IdCustomer)),null==l.id)return console.log(\"insert\"),void a.query(\"INSERT INTO `bill` (`IdBill`, `id`, `IdUser`, `IdTable`, `IdCustomer`, `create_at`, `Sale`, `idStatus`, `Totalprice`, `Note`)  VALUES (null, '\"+n+\"', '\"+l.IdUser+\"', '\"+l.table.IdTable+\"', \"+s.parseNullToString(l.customer.IdCustomer)+\", current_timestamp(), '0', '0', '\"+l.totalprice+\"', '');\",(function(e,i){e?t.send({status:\"err\"}):a.query(\"SELECT IdBill FROM bill WHERE id = '\"+n+\"'\",(function(e,i){if(e)t.send({status:\"err\"});else{console.log(i);var n=\"\";l.menu.forEach((function(e,t){n=n+\"INSERT INTO `billdetail` (`IdDetail`, `IdBill`, `IdMenu`, `Quantity`, `Price`) VALUES (NULL, '\"+i[0].IdBill+\"', '\"+e.IdMenu+\"', '\"+e.Quantity+\"', '\"+e.Price+\"');\"})),console.log(n),a.query(n,(function(e,i){e?t.send({status:\"err\"}):t.send({status:\"success\"})}))}}))}));console.log(\"update\"),a.query(\"UPDATE `bill` SET `Totalprice` = '\"+l.totalprice+\"', `Note` = 'noteeeee', `IdCustomer` = \"+s.parseNullToString(l.customer.IdCustomer)+\" WHERE `bill`.`IdBill` = \"+l.id+\";\",(function(e,i){if(e)t.send({status:\"err\"});else{var n=\"\";l.menu.forEach((function(e,t){n=n+\"INSERT INTO `billdetail` (`IdDetail`, `IdBill`, `IdMenu`, `Quantity`, `Price`) VALUES (NULL, '\"+l.id+\"', '\"+e.IdMenu+\"', '\"+e.Quantity+\"', '\"+e.Price+\"');\"})),console.log(\"DELETE FROM billdetail WHERE IdBill = \"+l.id+\"; \"+n),a.query(\"DELETE FROM billdetail WHERE IdBill = \"+l.id+\"; \"+n,(function(e,i){e?t.send({status:\"err\"}):t.send({status:\"success\"})}))}}))})),l.post(\"/getuser\",(function(e,t,i){var l=e.headers.cookie;n.verify(l,\"shhhhh\",(function(e,i){e||t.send({user:i})}))})),l.post(\"/deletemenuofpos\",(function(e,t,i){a.query(\"DELETE FROM billdetail WHERE IdDetail = '\"+e.body.data+\"'\",(function(e,i){e?t.send({err:\"err\"}):t.send({success:\"success\"})}))})),l.post(\"/paymentpos\",(function(e,t,i){var l=e.body,n=r();console.log(s.parseNullToString(l.customer.IdCustomer)),null!=l.id?(console.log(\"update\"),a.query(\"UPDATE `bill` SET `idStatus` = '1' WHERE `bill`.`IdBill` = \"+l.id+\";\",(function(e,i){e?t.send({status:\"err\"}):t.send({status:\"success\"})}))):a.query(\"INSERT INTO `bill` (`IdBill`, `id`, `IdUser`, `IdTable`, `IdCustomer`, `create_at`, `Sale`, `idStatus`, `Totalprice`, `Note`)  VALUES (null, '\"+n+\"', '\"+l.IdUser+\"', '\"+l.table.IdTable+\"', \"+s.parseNullToString(l.customer.IdCustomer)+\", current_timestamp(), '0', '1', '\"+l.totalprice+\"', '');\",(function(e,i){e?t.send({status:\"err\"}):a.query(\"SELECT IdBill FROM bill WHERE id = '\"+n+\"'\",(function(e,i){if(e)t.send({status:\"err\"});else{console.log(i);var n=\"\";l.menu.forEach((function(e,t){n=n+\"INSERT INTO `billdetail` (`IdDetail`, `IdBill`, `IdMenu`, `Quantity`, `Price`) VALUES (NULL, '\"+i[0].IdBill+\"', '\"+e.IdMenu+\"', '\"+e.Quantity+\"', '\"+e.Price+\"');\"})),console.log(n),a.query(n,(function(e,i){e?t.send({status:\"err\"}):t.send({status:\"success\"})}))}}))}))})),e.exports=l},444:function(e,t,i){\"use strict\";e.exports={parseNullToString:function(e){return void 0===e?null:\"'\"+e+\"'\"}}},49:function(e,t,i){\"use strict\";var l=i(323);function a(e,t,i,l,a,n){var s=i+\" LIMIT \"+t+\",\"+e;a.query(s,(function(t,i){t?n.send({error:\"SELECT\"}):a.query(l,(function(t,l){if(t)n.send({error:\"COUNT\"});else{var a=Math.ceil(l[0].count/e);n.json({data:i,count:a})}}))}))}e.exports.query_inSert=function(e,t,i,l,n,s,r){i?s.query(i,(function(i,o){i?r.send({error:\"INSERT\"}):a(e,t,l,n,s,r)})):a(e,t,l,n,s,r)},e.exports.query_Room=function(e,t,i,a){e?i.query(e,(function(e,s){console.log(\"dasd\"),console.log(s),console.log(e),e?a.send({error:l.Type}):n(t,i,a)})):n(t,i,a)};var n=function(e,t,i){t.query(e,(function(e,t){e?i.send({error:l.Type}):i.json(t)}))}},5:function(e,t){e.exports=require(\"stream\")},55:function(e,t){e.exports=require(\"net\")},59:function(e,t){e.exports=require(\"querystring\")},6:function(e,t){e.exports=require(\"buffer\")},60:function(e,t){e.exports=require(\"url\")},68:function(e,t,i){\"use strict\";e.exports.pagination=function(e){return{numberOfpageForpagination:5,pageForgGetData:5*(e-1)}}},8:function(e,t){e.exports=require(\"path\")},9:function(e,t){e.exports=require(\"fs\")},96:function(e,t){e.exports=require(\"string_decoder\")},99:function(e,t){e.exports=require(\"zlib\")}};","extractedComments":[]}