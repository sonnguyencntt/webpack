{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{112:function(e,t,l){\"use strict\";e.exports.pagination=function(e){return{numberOfpageForpagination:5,pageForgGetData:5*(e-1)}}},211:function(e,t,l){\"use strict\";var i=l(212);e.exports.pool=i.createPool({host:\"localhost\",user:\"root\",password:\"\",database:\"caffee\",multipleStatements:!0})},278:function(e,t,l){\"use strict\";e.exports={query_select:\"SELECT bill.IdBill,bill.id, staff.name, tables.TableName, customers.CustomerName,DATE_FORMAT(bill.create_at , '%d-%m-%y %h:%m:%s') as create_at,bill.idStatus,bill.Totalprice, bill.Note, GROUP_CONCAT(billdetail.IdDetail SEPARATOR '@#$') as idbilldetail  ,GROUP_CONCAT(billdetail.IdMenu SEPARATOR '@#$') as idmenu, GROUP_CONCAT(billdetail.Quantity SEPARATOR '@#$') as quantity, GROUP_CONCAT(billdetail.Price SEPARATOR '@#$') as billdetail_price , GROUP_CONCAT(menus.NameMenu SEPARATOR '@#$') as namemenu,GROUP_CONCAT(menus.Unit SEPARATOR '@#$') as unit,GROUP_CONCAT(menus.Price SEPARATOR '@#$') as menu_price FROM  billdetail,users,tables,staff, menus, bill LEFT JOIN customers ON bill.IdCustomer = customers.IdCustomer   WHERE bill.IdBill = billdetail.IdBill and bill.IdUser=users.UserId and bill.IdTable = tables.IdTable  AND users.id_staff = staff.id AND billdetail.IdMenu = menus.IdMenu GROUP BY billdetail.IdBill\",query_searchfor_Idbill:function(e){return\"SELECT bill.IdBill, staff.name, tables.TableName, customers.CustomerName,DATE_FORMAT(bill.create_at , '%d-%m-%y %h:%m:%s') as create_at,bill.idStatus,bill.Totalprice, bill.Note, GROUP_CONCAT(billdetail.IdDetail SEPARATOR '@#$') as idbilldetail  ,GROUP_CONCAT(billdetail.IdMenu SEPARATOR '@#$') as idmenu, GROUP_CONCAT(billdetail.Quantity SEPARATOR '@#$') as quantity, GROUP_CONCAT(billdetail.Price SEPARATOR '@#$') as billdetail_price , GROUP_CONCAT(menus.NameMenu SEPARATOR '@#$') as namemenu,GROUP_CONCAT(menus.Unit SEPARATOR '@#$') as unit,GROUP_CONCAT(menus.Price SEPARATOR '@#$') as menu_price FROM bill, billdetail,users,tables,customers,staff, menus  WHERE bill.IdBill = billdetail.IdBill and bill.IdUser=users.UserId and bill.IdTable = tables.IdTable and bill.IdCustomer = customers.IdCustomer AND users.id_staff = staff.id AND billdetail.IdMenu = menus.IdMenu AND bill.IdBill LIKE '%\"+e+\"%'  GROUP BY billdetail.IdBill\"},query_searchfor_datetime:function(e,t){return\"SELECT bill.IdBill, staff.name, tables.TableName, customers.CustomerName,DATE_FORMAT(bill.create_at , '%d-%m-%y %h:%m:%s') as create_at,bill.idStatus,bill.Totalprice, bill.Note, GROUP_CONCAT(billdetail.IdDetail SEPARATOR '@#$') as idbilldetail  ,GROUP_CONCAT(billdetail.IdMenu SEPARATOR '@#$') as idmenu, GROUP_CONCAT(billdetail.Quantity SEPARATOR '@#$') as quantity, GROUP_CONCAT(billdetail.Price SEPARATOR '@#$') as billdetail_price , GROUP_CONCAT(menus.NameMenu SEPARATOR '@#$') as namemenu,GROUP_CONCAT(menus.Unit SEPARATOR '@#$') as unit,GROUP_CONCAT(menus.Price SEPARATOR '@#$') as menu_price FROM bill, billdetail,users,tables,customers,staff, menus  WHERE bill.IdBill = billdetail.IdBill and bill.IdUser=users.UserId and bill.IdTable = tables.IdTable and bill.IdCustomer = customers.IdCustomer AND users.id_staff = staff.id AND billdetail.IdMenu = menus.IdMenu AND bill.create_at BETWEEN '\"+e+\" 00:00:01' AND '\"+t+\" 23:59:59'  GROUP BY billdetail.IdBill\"},query_exportExcel:\"SELECT bill.IdBill, staff.name, tables.TableName, customers.CustomerName,DATE_FORMAT(bill.create_at , '%d-%m-%y %h:%m:%s') as create_at,bill.idStatus,bill.Totalprice, bill.Note, billdetail.IdDetail ,billdetail.IdMenu ,billdetail.Quantity, billdetail.Price ,menus.NameMenu ,menus.Unit ,menus.Price FROM bill, billdetail,users,tables,customers,staff, menus  WHERE bill.IdBill = billdetail.IdBill and bill.IdUser=users.UserId and bill.IdTable = tables.IdTable and bill.IdCustomer = customers.IdCustomer AND users.id_staff = staff.id AND billdetail.IdMenu = menus.IdMenu \"}},279:function(e,t,l){\"use strict\";(function(t){var i=l(135),a=l(20),n=i(),s=a.join(t,\"./../views\");a.join(t,\"./../assets\");n.set(\"view engine\",\"ejs\"),n.use(i.static(t+\"./../assets\")),n.set(\"views\",s),n.listen(4e3);var r=l(211),o=l(508),u=r.pool,d=l(538),c=l(540),E=l(541),b=l(542),m=l(113),f=l(559),T=l(561),p=l(658),I=l(278),R=l(659);n.use(\"/pos\",R),n.get(\"*\",(function(e,t){t.render(\"home\")})),n.use(o.json(),f.check_authenTication),n.post(\"/query/selectalldata\",(function(e,t,l){var i=e.decodeToken;switch((e=e.body).type+\"|\"+i.name){case\"TABLE|admin\":d.select_all_data(e,u,t);break;case\"ROOM|admin\":c.select_all_data(u,t);break;case\"SUPPLIER|admin\":E.select_all_data(e,u,t);break;case\"CUSTOMER|admin\":b.select_all_data(e,u,t);break;default:t.send({err:\"err\"})}})),n.post(\"/query/insertdata\",(function(e,t,l){var i=e.decodeToken;switch((e=e.body).type+\"|\"+i.name){case\"TABLE|admin\":d.insert(e,u,t);break;case\"ROOM|admin\":c.insert(e,u,t);break;case\"SUPPLIER|admin\":E.insert(e,u,t);break;case\"CUSTOMER|admin\":b.insert(e,u,t);break;default:t.send({err:\"err\"})}})),n.post(\"/get\",(function(e,t,l){t.send(e.body.user)})),n.post(\"/query/updatedata\",(function(e,t,l){var i=e.decodeToken;switch((e=e.body).type+\"|\"+i.name){case\"TABLE|admin\":d.update(e,u,t);break;case\"ROOM|admin\":c.update(e,u,t);break;case\"SUPPLIER|admin\":E.update(e,u,t);break;case\"CUSTOMER|admin\":b.update(e,u,t);break;default:t.send({err:\"err\"})}})),n.post(\"/query/deletedata\",(function(e,t,l){var i=e.decodeToken;switch((e=e.body).type+\"|\"+i.name){case\"TABLE|admin\":d.delete(e,u,t);break;case\"ROOM|admin\":c.delete(e,u,t);break;case\"SUPPLIER|admin\":E.delete(e,u,t);break;case\"CUSTOMER|admin\":b.delete(e,u,t);break;default:t.send({err:\"err\"})}})),n.post(\"/query/exportdata\",(function(e,t,l){if(e.decodeToken.name=\"admin\"){e=e.body;T.export_data(e.board,t,u)}})),n.post(\"/query/searchdata\",(function(e,t,l){if(e.decodeToken.name=\"admin\"){e=e.body;c.search(e,u,t)}})),n.post(\"/checkpass\",(function(e,t,l){e=e.body;u.query(\"SELECT * FROM users WHERE UserName ='\"+e.username+\"' and Pass = '\"+e.password+\"'\",(function(e,l){if(console.log(l),l.length>0){if(void 0!==l[0].UserId){var i={name:l[0].UserName,id_staff:l[0].id_staff},a=m.sign(i,\"shhhhh\",{expiresIn:\"30000000\"});t.send({token:a,user:l})}}else t.send({err:\"not availd token\"})}))})),n.post(\"/getstt\",(function(e,t){d.getSTT(e,u,t)})),n.post(\"/query/getstatistical\",(function(e,t){var l=\"SELECT(SELECT SUM(Totalprice) FROM   bill WHERE create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS total_revenue,(SELECT COUNT(*)FROM   bill WHERE create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS count_bill,(SELECT COUNT(*)FROM   bill, customers WHERE bill.IdCustomer = customers.IdCustomer and customers.Debit > 0 AND  create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS total_debit_bill,(SELECT SUM(customers.Debit)FROM   bill, customers WHERE bill.IdCustomer = customers.IdCustomer and customers.Debit > 0  AND  create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS sum_debit_bill,(SELECT COUNT(*)FROM   bill WHERE idStatus = 0 and create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS count_unpaid_bill,( SELECT SUM(Totalprice)FROM   bill WHERE idStatus = 0 AND create_at BETWEEN '\"+e.body.date+\" 00:00:01' AND '\"+e.body.date+\" 23:59:59') AS total_unpaid_bill\";u.query(l,(function(e,l){console.log(l),t.send(l)}))})),n.post(\"/chart\",(function(e,t){var l=[],i=e.body,a=i[0].split(\"/\").reverse().join(\"-\")+\" 00:00:01\",n=i[6].split(\"/\").reverse().join(\"-\")+\" 23:59:59\";u.query(\"SELECT SUM(Totalprice) as total,DATE_FORMAT(create_at, '%d/%m/%Y') as datetime FROM bill WHERE create_at BETWEEN '\"+a+\"' AND '\"+n+\"' GROUP BY create_at \",(function(e,a){i.forEach((function(e,t){return a.length>0&&a.forEach((function(i,a){return e==function(e){if(void 0!==e.datetime){var t=e.datetime.split(\"\");0==t[0]&&(t[0]=\"\"),0==t[3]&&(t[3]=\"\");var l=t.toString().replace(/,/gi,\"\");return console.log(l),l}return\"00/00/0000\"}(i)?(console.log(\"true\"),l[t]=i.total,l):(l[t]=0,l)})),l})),t.send(l)})),console.log(n)})),n.post(\"/query/selectallmenu\",(function(e,t){u.query(\"SELECT * FROM menus\",(function(e,l){t.send({menu:l})}))})),n.post(\"/query/selectOrder\",(function(e,t){console.log(\"da vao selectorder\"),p.query_select(t,u)})),n.post(\"/query/searchforbill\",(function(e,t){console.log(e.body),p.query_searchfor_Idbill(e.body.data,t,u)})),n.post(\"/query/searchfordatetime\",(function(e,t){var l=e.body.from,i=e.body.to;p.query_searchfor_datetime(l,i,t,u)})),n.post(\"/query/exportfrombill\",(function(e,t){console.log(I.query_exportExcel),p.query_exportData(I.query_exportExcel,t,u)})),e.exports=n}).call(this,\"/\")},304:function(e,t){},305:function(e,t){},308:function(e,t){},310:function(e,t){},343:function(e,t){},346:function(e,t){function l(e){var t=new Error(\"Cannot find module '\"+e+\"'\");throw t.code=\"MODULE_NOT_FOUND\",t}l.keys=function(){return[]},l.resolve=l,e.exports=l,l.id=346},348:function(e,t){},350:function(e,t){},357:function(e,t){},359:function(e,t){},387:function(e,t){},389:function(e,t){},390:function(e,t){},396:function(e,t){},398:function(e,t){},416:function(e,t){},419:function(e,t){},435:function(e,t){},438:function(e,t){},495:function(e,t){},497:function(e,t){},530:function(e,t){},531:function(e,t){},538:function(e,t,l){\"use strict\";var i;function a(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var n=l(112),s=l(80);function r(e,t,l,i){var a=\"SELECT * FROM tables WHERE IdArea LIKE '%\"+e.room+\"%' and IdTable LIKE '%\"+e.table+\"%' and idStatus LIKE '%\"+e.status+\"%'\",r=\"SELECT COUNT(*) as count FROM tables WHERE IdArea LIKE '%\"+e.room+\"%' and IdTable LIKE '%\"+e.table+\"%' and idStatus LIKE '%\"+e.status+\"%'\",o=n.pagination(e.index);s.query_inSert(o.numberOfpageForpagination,o.pageForgGetData,t,a,r,l,i)}e.exports=(a(i={insert:function(e,t,l){r(e,\"INSERT INTO tables (IdTable, TableName, idStatus,IdArea,idBill) VALUES ('\"+e.idtable+\"','\"+e.name+\"',1,'\"+e.idarea+\"','HD001')\",t,l)},select_all_data:function(e,t,l){r(e,null,t,l)}},\"select_all_data\",(function(e,t,l){r(e,null,t,l)})),a(i,\"update\",(function(e,t,l){r(e,\"UPDATE tables SET IdArea = '\"+e.idarea+\"' , IdTable  = \"+e.idtable+\" , TableName =  '\"+e.name+\"' WHERE IdTable =\"+e.idtable+\" \",t,l)})),a(i,\"delete\",(function(e,t,l){r(e,\"DELETE FROM tables WHERE IdTable = \"+e.idtable,t,l)})),a(i,\"getSTT\",(function(e,t,l){t.query(\"SELECT * FROM stttable\",(function(e,t){e?l.send([{}]):l.json(t)}))})),i)},539:function(e,t,l){\"use strict\";e.exports.Type=\"ERROR_FOR_QUERY_SQLSERVER\"},540:function(e,t,l){\"use strict\";var i=l(80);function a(e,t,l){i.query_Room(e,\"SELECT * FROM areas\",t,l)}e.exports.insert=function(e,t,l){a(\"INSERT INTO areas (IdArea, BranchName) VALUES ('\"+e.id+\"','\"+e.value+\"')\",t,l)},e.exports.select_all_data=function(e,t){a(null,e,t)},e.exports.update=function(e,t,l){a(\"UPDATE areas SET IdArea ='\"+e.idarea+\"', BranchName = '\"+e.name+\"' WHERE id = \"+e.id+\"  \",t,l)},e.exports.delete=function(e,t,l){a(\"DELETE FROM areas WHERE id =\"+e.id,t,l)},e.exports.search=function(e,t,l){var i=\"SELECT * FROM areas WHERE IdArea LIKE '%\"+e.name+\"%' OR BranchName LIKE '%\"+e.name+\"%'\";t.query(i,(function(e,t){e?l.send([{}]):l.json(t)}))}},541:function(e,t,l){\"use strict\";var i=l(112),a=l(80);function n(e,t,l,n){var s=\"SELECT * FROM suppliers WHERE Namesupplier LIKE '%\"+e.id+\"%' and Debit >= \"+e.debit,r=\"SELECT COUNT(*) as count FROM suppliers WHERE Namesupplier LIKE '%\"+e.id+\"%' and Debit >= \"+e.debit,o=i.pagination(e.index);a.query_inSert(o.numberOfpageForpagination,o.pageForgGetData,t,s,r,l,n)}e.exports.insert=function(e,t,l){n(e,\"INSERT INTO suppliers (Idsupplier, Namesupplier, Email,Phone,Address, Note, Debit, Avatar) VALUES ('\"+e.idsupplier+\"','\"+e.namesupplier+\"','\"+e.emailsupplier+\"','\"+e.phonesupplier+\"','\"+e.addresssupplier+\"','\"+e.notesupplier+\"','\"+e.debitsupplier+\"','\"+e.avatarsupplier+\"')\",t,l)},e.exports.select_all_data=function(e,t,l){n(e,null,t,l)},e.exports.update=function(e,t,l){n(e,\"UPDATE suppliers SET Idsupplier = '\"+e.idsupplier+\"' , Namesupplier  = '\"+e.namesupplier+\"' , Email =  '\"+e.emailsupplier+\"', Phone =  '\"+e.phonesupplier+\"', Address =  '\"+e.addresssupplier+\"', Note =  '\"+e.notesupplier+\"', Debit =  '\"+e.debitsupplier+\"', Avatar =  '\"+e.avatarsupplier+\"' WHERE id =\"+e.indexsupplier+\" \",t,l)},e.exports.delete=function(e,t,l){n(e,\"DELETE FROM suppliers WHERE id = \"+e.indexsupplier,t,l)},e.exports.getSTT=function(e,t,l){t.query(\"SELECT * FROM stttable\",(function(e,t){e?l.send([{}]):l.json(t)}))}},542:function(e,t,l){\"use strict\";var i=l(112),a=l(80);function n(e,t,l,n){var s=\"SELECT * FROM customers WHERE CustomerName LIKE '%\"+e.id+\"%' and Debit >= \"+e.debit,r=\"SELECT COUNT(*) as count FROM customers WHERE CustomerName LIKE '%\"+e.id+\"%' and Debit >= \"+e.debit,o=i.pagination(e.index);a.query_inSert(o.numberOfpageForpagination,o.pageForgGetData,t,s,r,l,n)}e.exports.insert=function(e,t,l){n(e,\"INSERT INTO customers (IdCustomer, CustomerName, PhoneNumber,Email,Address, Note,Birthday, Gender, Debit, Avatar) VALUES ('\"+e.idcustomer+\"','\"+e.namecustomer+\"','\"+e.phonecustomer+\"','\"+e.emailcustomer+\"','\"+e.addresscustomer+\"','\"+e.notecustomer+\"','\"+e.birthdaycustomer+\"',null,'\"+e.debitcustomer+\"','\"+e.avatarcustomer+\"')\",t,l)},e.exports.select_all_data=function(e,t,l){n(e,null,t,l)},e.exports.update=function(e,t,l){n(e,\"UPDATE customers SET IdCustomer  = '\"+e.idcustomer+\"' , CustomerName  = '\"+e.namecustomer+\"' , Email =  '\"+e.emailcustomer+\"', PhoneNumber =  '\"+e.phonecustomer+\"', Address =  '\"+e.addresscustomer+\"', Note =  '\"+e.notecustomer+\"', Debit =  '\"+e.debitcustomer+\"', Avatar =  '\"+e.avatarcustomer+\"', Birthday =  '\"+e.birthdaycustomer+\"' WHERE id =\"+e.indexcustomer+\" \",t,l)},e.exports.delete=function(e,t,l){n(e,\"DELETE FROM customers WHERE id = \"+e.indexcustomer,t,l)},e.exports.getSTT=function(e,t,l){t.query(\"SELECT * FROM stttable\",(function(e,t){e?l.send([{}]):l.json(t)}))}},559:function(e,t,l){\"use strict\";var i=l(560);e.exports={check_authenTication:function(e,t,l){if(console.log(e.body),\"/checkpass\"!=e.originalUrl){var a=e.headers.cookie;i.checkCookie(a,e,l,t)}else l()}}},560:function(e,t,l){\"use strict\";var i=l(113);e.exports={checkCookie:function(e,t,l,a){try{i.verify(e,\"shhhhh\",(function(e,i){if(e)return console.log(e),void a.send({token:!1});console.log(\"success\"),t.decodeToken=i,t.success=\"success\",l()}))}catch(e){return console.log(e),void a.send({err:e})}}}},561:function(e,t,l){\"use strict\";var i=l(239);function a(e,t){var l=new i.Workbook,a=l.addWorksheet(\"Sheet 1\"),n=Object.keys(e[0]);e.forEach((function(e,t){t+=1;n.forEach((function(l,i){i+=1;a.cell(t,i).string(e[l].toString())}))})),l.write(\"Excel.xlsx\",t)}t.export_data=function(e,t,l){console.log(\"export\");var i=\"SELECT * FROM \"+e;l.query(i,(function(e,l){e&&a([{}],t),a(l,t)}))}},658:function(e,t,l){\"use strict\";var i=l(278),a=l(239);function n(e,t){var l=new a.Workbook,i=l.addWorksheet(\"Sheet 1\"),n=Object.keys(e[0]);e.forEach((function(e,t){t+=1;n.forEach((function(l,a){a+=1;i.cell(t,a).string(e[l].toString())}))})),l.write(\"Excel.xlsx\",t)}function s(e,t,l){if(console.log(l),!t)if(0!=l.length)for(var i=0;i<=l.length;i++){if(i==l.length)return console.log(l),void e.send(l);for(var a=[{}],n=l[i].idbilldetail.split(\"@#$\"),s=0;s<n.length;s++)a[s]={namemenu:l[i].namemenu.split(\"@#$\")[s],idbilldetail:l[i].idbilldetail.split(\"@#$\")[s],idmenu:l[i].idmenu.split(\"@#$\")[s],quantity:l[i].quantity.split(\"@#$\")[s],billdetail_price:l[i].billdetail_price.split(\"@#$\")[s],unit:l[i].unit.split(\"@#$\")[s],menu_price:l[i].menu_price.split(\"@#$\")[s]};l[i].menu_detail=JSON.stringify([].concat(a))}else e.send(l)}e.exports={query_select:function(e,t){t.query(i.query_select,(function(t,l){s(e,t,l)}))},query_searchfor_Idbill:function(e,t,l){console.log(i.query_searchfor_Idbill(e)),l.query(i.query_searchfor_Idbill(e),(function(e,l){s(t,e,l)}))},query_searchfor_datetime:function(e,t,l,a){console.log(i.query_searchfor_datetime(e,t)),a.query(i.query_searchfor_datetime(e,t),(function(e,t){s(l,e,t)}))},query_exportData:function(e,t,l){l.query(e,(function(e,l){e&&n([{}],t),n(l,t)}))}}},659:function(e,t,l){\"use strict\";var i=l(135)(),a=l(211).pool,n=l(113),s=l(660);function r(){var e=new Date,t=new Date;return\"HD-\"+(e.getDate()<10?\"0\":\"\")+e.getDate()+\"/\"+(Number(e.getMonth())+1<10?\"0\":\"\")+(Number(e.getMonth())+1)+\"/\"+e.getFullYear()+\" \"+(t.getHours()<10?\"0\":\"\")+e.getHours()+\":\"+(e.getMinutes()<10?\"0\":\"\")+e.getMinutes()+\":\"+(e.getSeconds()<10?\"0\":\"\")+e.getSeconds()}i.post(\"/getarea\",(function(e,t,l){a.query(\"SELECT * FROM areas\",(function(e,l){a.query(\"SELECT tables.IdTable, TableName,tables.idStatus,IdArea, bill.IdBill FROM tables LEFT JOIN bill ON tables.IdTable = bill.IdTable AND bill.idStatus = 0 WHERE tables.IdArea = '\"+l[0].IdArea+\"'\",(function(e,i){t.send({area:l,table:i})}))}))})),i.post(\"/gettableforselect\",(function(e,t,l){a.query(\"SELECT tables.IdTable, TableName,tables.idStatus,IdArea, bill.IdBill FROM tables LEFT JOIN bill ON tables.IdTable = bill.IdTable AND bill.idStatus = 0 WHERE tables.IdArea = '\"+e.body.data+\"'\",(function(e,l){t.send({table:l})}))})),i.post(\"/getcate\",(function(e,t,l){a.query(\"SELECT * FROM categories\",(function(e,l){a.query(\"SELECT * FROM menus WHERE Idcate = '\"+l[0].Idcate+\"' \",(function(e,i){t.send({cate:l,menu:i})}))}))})),i.post(\"/getmenuforselect\",(function(e,t,l){a.query(\"SELECT * FROM menus WHERE Idcate = \"+e.body.data+\" \",(function(e,l){t.send({menu:l})}))})),i.post(\"/searchmenu\",(function(e,t,l){\"\"!=e.body.data?(console.log(\"SELECT * FROM menus WHERE IdMenu LIKE %\"+e.body.data+\"% or NameMenu LIKE '%\"+e.body.data+\"%'\"),a.query(\"SELECT * FROM menus WHERE IdMenu LIKE '%\"+e.body.data+\"%' or NameMenu LIKE '%\"+e.body.data+\"%' \",(function(e,l){t.send({menu:l})}))):t.send({menu:[{non_Query:\"non_query\"}]})})),i.post(\"/getcustomer\",(function(e,t,l){\"\"!=e.body.data?a.query(\"SELECT * FROM customers  WHERE CustomerName LIKE '%\"+e.body.data+\"%' OR PhoneNumber LIKE '%\"+e.body.data+\"%' \",(function(e,l){t.send({customers:l})})):t.send({customers:[]})})),i.post(\"/getlistbilldetail\",(function(e,t,l){a.query(\"SELECT bill.IdBill FROM tables , bill WHERE tables.IdTable = bill.IdTable AND bill.idStatus = 0 AND tables.IdTable = \"+e.body.IdTable,(function(l,i){console.log(i),i.length>0?a.query(\"SELECT * FROM bill  WHERE IdBill  = '\"+i[0].IdBill+\"' \",(function(e,l){a.query(\"SELECT * FROM customers  WHERE IdCustomer = '\"+l[0].IdCustomer+\"'\",(function(e,n){a.query(\"SELECT * FROM tables  WHERE IdTable  = \"+l[0].IdTable,(function(e,s){a.query(\"SELECT billdetail.IdBill, billdetail.IdMenu, billdetail.Quantity, billdetail.Price as TotalPrice, menus.NameMenu, menus.Price FROM menus , billdetail WHERE IdBill = '\"+l[0].IdBill+\"' AND billdetail.IdMenu = menus.IdMenu\",(function(e,r){console.log(\"SELECT billdetail.IdBill, billdetail.IdMenu, billdetail.Quantity, billdetail.Price as TotalPrice, menus.NameMenu, menus.Price FROM menus , billdetail WHERE IdBill = '\"+l[0].IdBill+\"' AND billdetail.IdMenu = menus.IdMenu\"),a.query(\"SELECT TotalPrice FROM bill  WHERE IdBill  = '\"+l[0].IdBill+\"'\",(function(e,l){t.send({customer:n,table:s,menu:r,totalprice:l,idbill_default:i[0].IdBill})}))}))}))}))})):a.query(\"SELECT * FROM tables WHERE IdTable = '\"+e.body.IdTable+\"'\",(function(e,l){t.send({customer:[{}],table:l,menu:[],totalprice:[{TotalPrice:0}],idbill_default:null})}))}))})),console.log(r()),i.post(\"/insertpos\",(function(e,t,l){var i=e.body,n=r();if(console.log(s.parseNullToString(i.customer.IdCustomer)),null==i.id)return console.log(\"insert\"),void a.query(\"INSERT INTO `bill` (`IdBill`, `id`, `IdUser`, `IdTable`, `IdCustomer`, `create_at`, `Sale`, `idStatus`, `Totalprice`, `Note`)  VALUES (null, '\"+n+\"', '\"+i.IdUser+\"', '\"+i.table.IdTable+\"', \"+s.parseNullToString(i.customer.IdCustomer)+\", current_timestamp(), '0', '0', '\"+i.totalprice+\"', '');\",(function(e,l){e?t.send({status:\"err\"}):a.query(\"SELECT IdBill FROM bill WHERE id = '\"+n+\"'\",(function(e,l){if(e)t.send({status:\"err\"});else{console.log(l);var n=\"\";i.menu.forEach((function(e,t){n=n+\"INSERT INTO `billdetail` (`IdDetail`, `IdBill`, `IdMenu`, `Quantity`, `Price`) VALUES (NULL, '\"+l[0].IdBill+\"', '\"+e.IdMenu+\"', '\"+e.Quantity+\"', '\"+e.Price+\"');\"})),console.log(n),a.query(n,(function(e,l){e?t.send({status:\"err\"}):t.send({status:\"success\"})}))}}))}));console.log(\"update\"),a.query(\"UPDATE `bill` SET `Totalprice` = '\"+i.totalprice+\"', `Note` = 'noteeeee', `IdCustomer` = \"+s.parseNullToString(i.customer.IdCustomer)+\" WHERE `bill`.`IdBill` = \"+i.id+\";\",(function(e,l){if(e)t.send({status:\"err\"});else{var n=\"\";i.menu.forEach((function(e,t){n=n+\"INSERT INTO `billdetail` (`IdDetail`, `IdBill`, `IdMenu`, `Quantity`, `Price`) VALUES (NULL, '\"+i.id+\"', '\"+e.IdMenu+\"', '\"+e.Quantity+\"', '\"+e.Price+\"');\"})),console.log(\"DELETE FROM billdetail WHERE IdBill = \"+i.id+\"; \"+n),a.query(\"DELETE FROM billdetail WHERE IdBill = \"+i.id+\"; \"+n,(function(e,l){e?t.send({status:\"err\"}):t.send({status:\"success\"})}))}}))})),i.post(\"/getuser\",(function(e,t,l){var i=e.headers.cookie;n.verify(i,\"shhhhh\",(function(e,l){e||t.send({user:l})}))})),i.post(\"/deletemenuofpos\",(function(e,t,l){a.query(\"DELETE FROM billdetail WHERE IdDetail = '\"+e.body.data+\"'\",(function(e,l){e?t.send({err:\"err\"}):t.send({success:\"success\"})}))})),i.post(\"/paymentpos\",(function(e,t,l){var i=e.body,n=r();console.log(s.parseNullToString(i.customer.IdCustomer)),null!=i.id?(console.log(\"update\"),a.query(\"UPDATE `bill` SET `idStatus` = '1' WHERE `bill`.`IdBill` = \"+i.id+\";\",(function(e,l){e?t.send({status:\"err\"}):t.send({status:\"success\"})}))):a.query(\"INSERT INTO `bill` (`IdBill`, `id`, `IdUser`, `IdTable`, `IdCustomer`, `create_at`, `Sale`, `idStatus`, `Totalprice`, `Note`)  VALUES (null, '\"+n+\"', '\"+i.IdUser+\"', '\"+i.table.IdTable+\"', \"+s.parseNullToString(i.customer.IdCustomer)+\", current_timestamp(), '0', '1', '\"+i.totalprice+\"', '');\",(function(e,l){e?t.send({status:\"err\"}):a.query(\"SELECT IdBill FROM bill WHERE id = '\"+n+\"'\",(function(e,l){if(e)t.send({status:\"err\"});else{console.log(l);var n=\"\";i.menu.forEach((function(e,t){n=n+\"INSERT INTO `billdetail` (`IdDetail`, `IdBill`, `IdMenu`, `Quantity`, `Price`) VALUES (NULL, '\"+l[0].IdBill+\"', '\"+e.IdMenu+\"', '\"+e.Quantity+\"', '\"+e.Price+\"');\"})),console.log(n),a.query(n,(function(e,l){e?t.send({status:\"err\"}):t.send({status:\"success\"})}))}}))}))})),e.exports=i},660:function(e,t,l){\"use strict\";e.exports={parseNullToString:function(e){return void 0===e?null:\"'\"+e+\"'\"}}},80:function(e,t,l){\"use strict\";var i=l(539);function a(e,t,l,i,a,n){var s=l+\" LIMIT \"+t+\",\"+e;a.query(s,(function(t,l){t?n.send({error:\"SELECT\"}):a.query(i,(function(t,i){if(t)n.send({error:\"COUNT\"});else{var a=Math.ceil(i[0].count/e);n.json({data:l,count:a})}}))}))}e.exports.query_inSert=function(e,t,l,i,n,s,r){l?s.query(l,(function(l,o){l?r.send({error:\"INSERT\"}):a(e,t,i,n,s,r)})):a(e,t,i,n,s,r)},e.exports.query_Room=function(e,t,l,a){e?l.query(e,(function(e,s){console.log(\"dasd\"),console.log(s),console.log(e),e?a.send({error:i.Type}):n(t,l,a)})):n(t,l,a)};var n=function(e,t,l){t.query(e,(function(e,t){e?l.send({error:i.Type}):l.json(t)}))}}},[[279,1,2]]]);","extractedComments":[]}